title: 《jQuery技术内幕》· Sizzle · chunker
date: 2016-03-10 13:13:54
tags: Web
---
> 本文主要结合《jQuery技术内幕》一书，对于Sizzle里面的chunker正则进行解析

### 预备知识
+ 正则的相关知识 [链接](http://www.runoob.com/regexp/regexp-metachar.html)
+ javaScript中正则对象exec方法的使用
+ 特别说明
	- 正则中小括号就是括号内看成一个整体，而且需要捕获；中括号就是匹配括号内的任意其中一个
	- `?:`只能针对当层小括号的捕获内容不进行缓存在结果数组中，但没有递归的特性，也就是说子括号的内容还是可以捕获缓存的
	- 知道+表示对前面的内容匹配1次或是多次，?表示匹配0次或1次，*表示匹配0次或多次
	- 对于捕获块有一个特性，就是说如果捕获块也就是括号后面如果有+的话，也就是允许多次匹配的话，则捕获后的数组内容是按最后一次捕获的内容来计算的，也就是说有覆盖性。比如 `var test = /(\w)|#(\w)+/;console.log(test.exec("#qw"))` 因为有了一个+所以对应的第二个捕获的内容是w，而不是q，当没有了+的话，就是q

### chunker解析
+ 表达式 `var chunker = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g`
+ 测试可以使用exec方法进行测试
+ 解析图片来自《jQuery技术内幕》一书
	- ![图片](http://7xncgn.com1.z0.glb.clouddn.com/16-3-10/41367962.jpg)
+  
```javaScript
var chunker = /(
	(?:
		\((?:\([^()]+\)|[^()]+)+\) //函数过滤块，用于匹配比如:has(selector)里面的(selector)
		|\[					  //外层的[]属性过滤块
			(?:\[[^\[\]]*\]   //1)?:表示不缓存内层捕获块内容;2)内层的 []中, `\[`,`\]`表示转义的, `[^\[\]]*`表示匹配0次或多次除了`[`,`]`的内容
			|['"][^'"]*['"]   //内层的 ''""
			|[^\[\]'"]+)      //表示没有引号括号包裹的内容，同时也是?:捕获块的结束,最后的加号针对前面的三种情况进行字符的多次匹配，比如表示对前面的除了[]内容的内容的进行一次或多次匹配，比如[abc]有了+后就可以匹配到'abc'而不是‘c’只有最后的一个字符
		+\]	                  //可以进行多次内层的匹配，比如匹配[[abc]"abc"] ，没有了的话，会怎么样呢，就是当出现所举例子的情况的时候，匹配到了[[abc]此时它要看到的是‘]’，如果没有话呢，自然就匹配不成功了
		|\\.   //转义\ +任意字符
		|[^ >+~,(\[\\]+  //简单选择块，伪类过滤块，比如#id等
	)+  //结束一开始的?:过滤块，并可以多次匹配
	|[>+~])  //块间关系符
	(\s*,\s*)?  //支持包含有空白字符的逗号，用于并列的表达式
	((?:.|\r|\n)* //并列表达式内容
)/g
```